---
- name: Deploy Jenkins Server
  hosts: ciservers
  become: true
  vars_files:
    - vars/rhsm_vars.yml
    - vars/jenkins_vars.yml

  roles:
  - role: openstack.redhat-subscription
  - role: geerlingguy.java
    when: "ansible_os_family == 'RedHat'"
  - role: geerlingguy.jenkins

  tasks:
  - name: Enable Jenkins http 8080
    firewalld:
      state: enabled
      permanent: true
      port: 8080/tcp
    tags:
      - jenkins_firewall
  - name: Reload firewalld service
    service:
      name: firewalld
      state: reloaded
      enabled: true
    tags:
      - jenkins_restart

  tags:
    - jenkins
    - devsecops